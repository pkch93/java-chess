<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>체스 게임</title>
    <style>
        table.chessboard {
            margin: 80px auto;
            background: #999;
            border: 25px solid #333;
            border-collapse: collapse;
        }

        td.chessboard {
            width: 70px;
            height: 70px;
            text-align: center;
        }

        tr.chessboard:nth-child(odd) td.chessboard:nth-child(even),
        tr.chessboard:nth-child(even) td.chessboard:nth-child(odd) {
            background: white;
        }
    </style>
</head>
<body>
<div>
    <table class="chessboard">
        <tr class="chessboard">
            <td class="chessboard" id="a8"></td>
            <td class="chessboard" id="b8"></td>
            <td class="chessboard" id="c8"></td>
            <td class="chessboard" id="d8"></td>
            <td class="chessboard" id="e8"></td>
            <td class="chessboard" id="f8"></td>
            <td class="chessboard" id="g8"></td>
            <td class="chessboard" id="h8"></td>
        </tr>
        <tr class="chessboard">
            <td class="chessboard" id="a7"></td>
            <td class="chessboard" id="b7"></td>
            <td class="chessboard" id="c7"></td>
            <td class="chessboard" id="d7"></td>
            <td class="chessboard" id="e7"></td>
            <td class="chessboard" id="f7"></td>
            <td class="chessboard" id="g7"></td>
            <td class="chessboard" id="h7"></td>
        </tr>
        <tr class="chessboard">
            <td class="chessboard" id="a6"></td>
            <td class="chessboard" id="b6"></td>
            <td class="chessboard" id="c6"></td>
            <td class="chessboard" id="d6"></td>
            <td class="chessboard" id="e6"></td>
            <td class="chessboard" id="f6"></td>
            <td class="chessboard" id="g6"></td>
            <td class="chessboard" id="h6"></td>
        </tr>
        <tr class="chessboard">
            <td class="chessboard" id="a5"></td>
            <td class="chessboard" id="b5"></td>
            <td class="chessboard" id="c5"></td>
            <td class="chessboard" id="d5"></td>
            <td class="chessboard" id="e5"></td>
            <td class="chessboard" id="f5"></td>
            <td class="chessboard" id="g5"></td>
            <td class="chessboard" id="h5"></td>
        </tr>
        <tr class="chessboard">
            <td class="chessboard" id="a4"></td>
            <td class="chessboard" id="b4"></td>
            <td class="chessboard" id="c4"></td>
            <td class="chessboard" id="d4"></td>
            <td class="chessboard" id="e4"></td>
            <td class="chessboard" id="f4"></td>
            <td class="chessboard" id="g4"></td>
            <td class="chessboard" id="h4"></td>
        </tr>
        <tr class="chessboard">
            <td class="chessboard" id="a3"></td>
            <td class="chessboard" id="b3"></td>
            <td class="chessboard" id="c3"></td>
            <td class="chessboard" id="d3"></td>
            <td class="chessboard" id="e3"></td>
            <td class="chessboard" id="f3"></td>
            <td class="chessboard" id="g3"></td>
            <td class="chessboard" id="h3"></td>
        </tr>
        <tr class="chessboard">
            <td class="chessboard" id="a2"></td>
            <td class="chessboard" id="b2"></td>
            <td class="chessboard" id="c2"></td>
            <td class="chessboard" id="d2"></td>
            <td class="chessboard" id="e2"></td>
            <td class="chessboard" id="f2"></td>
            <td class="chessboard" id="g2"></td>
            <td class="chessboard" id="h2"></td>
        </tr>
        <tr class="chessboard">
            <td class="chessboard" id="a1"></td>
            <td class="chessboard" id="b1"></td>
            <td class="chessboard" id="c1"></td>
            <td class="chessboard" id="d1"></td>
            <td class="chessboard" id="e1"></td>
            <td class="chessboard" id="f1"></td>
            <td class="chessboard" id="g1"></td>
            <td class="chessboard" id="h1"></td>
        </tr>
    </table>
</div>
<div>
    <div>
        <form action="/game_play" method="POST">
            <div class="row">
                <input name="source" type="text">
                <input name="target" type="text">
                <input type="submit" value="move">
            </div>
        </form>
    </div>
    <div>
        <form action="/result">
            <button type="submit">end</button>
        </form>
    </div>
    <div>
        <form action="/result">
            <button type="submit">status</button>
        </form>
    </div>
</div>
<script>
    const url = "/img/";
    const pieceNames = {
        p: 'pawn',
        r: 'rook',
        b: 'bishop',
        q: 'queen',
        k: 'king',
        n: 'knight',
    };

    const getBoardData = async () => {
        return await fetch("/status", {method: "POST"})
            .then(data => data.json())
            .catch(err => console.log(err));
    };

    const convertImgName = (pieceName, team) => {
        let result = pieceNames[pieceName];
        if (team === 'WHITE') {
            result = result + '_white';
        }
        return result;
    };

    const board = getBoardData();
    board.then(boardData => {
        for (each of boardData) {
            const {position, pieceName, team} = each;
            const tail = document.getElementById(position);
            const imgName = convertImgName(pieceName, team);
            tail.innerHTML = `<img src="${url + imgName}.png">`;
        }
    })
        .catch(err => console.log(err));
</script>
</body>
</html>